(this.webpackJsonpweb=this.webpackJsonpweb||[]).push([[0],{31:function(e,t,a){e.exports=a(65)},53:function(e,t,a){},61:function(e,t,a){},62:function(e,t,a){},63:function(e,t,a){},64:function(e,t,a){},65:function(e,t,a){"use strict";a.r(t);var n=a(0),l=a.n(n),c=a(28),r=a.n(c);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var i=a(3),o=a(5),u=a.n(o),m=a(1),s=a(4),d=a(30),p=(a(53),0);function f(e){var t=Object(m.g)(),a=Object(n.useState)([{id:p++,value:""}]),c=Object(i.a)(a,2),r=c[0],o=c[1],f=Object(n.useRef)(),E=Object(n.useRef)(),v=Object(n.useRef)(),b=Object(n.useRef)();return l.a.createElement("div",null,"true"===e.multiple?l.a.createElement("div",{className:"top-banner"},"\u65b0\u5efa\u591a\u9009\u6295\u7968"):l.a.createElement("div",{className:"top-banner"},"\u65b0\u5efa\u5355\u9009\u6295\u7968"),l.a.createElement(s.b,{to:"/",id:"back"},"<"),l.a.createElement("form",{onSubmit:function(a){return function(a){a.preventDefault(),f.current.value&&r.length>=2&&v.current.value?u.a.post("/createVote",{topic:f.current.value,directions:E.current.value,multiple:e.multiple,options:r,deadline:v.current.value,hideName:b.current.checked}).then((function(e){t.push("/voting/"+e.data.voteId)})):alert("\u4fe1\u606f\u672a\u586b\u5199\u5b8c\u6574\uff01")}(a)}},l.a.createElement("input",{ref:f,type:"text",placeholder:"\u6295\u7968\u6807\u9898"}),l.a.createElement("input",{ref:E,type:"text",placeholder:"\u8865\u5145\u63cf\u8ff0\uff08\u9009\u586b\uff09"}),l.a.createElement("ul",{style:{listStyle:"none"}},r.map((function(e){return l.a.createElement("li",{key:e.id},l.a.createElement("div",{onClick:function(){return o(r.filter((function(t){return e.id!==t.id})))}},"X"),l.a.createElement("input",{type:"text",placeholder:"\u9009\u9879",value:e.value,onChange:function(t){return function(e,t){o(r.map((function(a){return a.id===t.id?{id:t.id,value:e.target.value}:a})))}(t,e)}}))}))),l.a.createElement("div",{onClick:function(e){e.preventDefault(),o([].concat(Object(d.a)(r),[{id:p++,value:""}]))}},"+\u6dfb\u52a0\u9009\u9879"),l.a.createElement("div",{id:"deadline"},l.a.createElement("div",null,"\u622a\u6b62\u65e5\u671f"),l.a.createElement("input",{ref:v,type:"datetime-local"})),l.a.createElement("div",{id:"hidename"},l.a.createElement("input",{ref:b,type:"checkbox"}),l.a.createElement("div",null,"\u533f\u540d\u6295\u7968")),l.a.createElement("button",{id:"submit"},"\u5b8c\u6210")))}function E(e){var t=Object(m.g)(),a=Object(n.useRef)(),c=Object(n.useRef)(),r=Object(n.useRef)(),o=Object(n.useRef)(),s=Object(n.useState)("/uploads/0.jpg"),d=Object(i.a)(s,2),p=d[0],f=d[1];return l.a.createElement("div",null,l.a.createElement("form",{action:"/api/register",method:"POST",encType:"multipart/form-data",onSubmit:function(e){return function(e){e.preventDefault(),u.a.post("/register",{name:a.current.value,password:r.current.value,email:o.current.value,avatar:p}).then((function(e){1===e.data.code?(alert("\u6ce8\u518c\u6210\u529f\uff0c\u8bf7\u767b\u5f55\uff01"),t.push("/noLogin/login")):alert(e.data.result)}))}(e)}},l.a.createElement("div",null,"\u7528\u6237\u540d\uff1a"),l.a.createElement("input",{type:"text",ref:a,onChange:function(e){if(!e.target.value)return void(c.current.textContent="*");u.a.get("/username-conflict-check?name="+e.target.value).then((function(e){c.current.textContent=e.data.msg}))}}),l.a.createElement("div",{ref:c,style:{color:"red"}},"*"),l.a.createElement("div",null,"\u5bc6\u7801\uff1a"),l.a.createElement("input",{type:"password",ref:r}),l.a.createElement("div",null,"\u90ae\u7bb1\uff1a"),l.a.createElement("input",{type:"text",ref:o}),l.a.createElement("div",null,"\u5934\u50cf\u4e0a\u4f20\uff1a"),l.a.createElement("label",{htmlFor:"avatar"},l.a.createElement("img",{src:p,alt:"avatar",style:{width:"100px"}})),l.a.createElement("input",{type:"file",id:"avatar",style:{display:"none"},onChange:function(e){return function(e){var t=new FormData;t.append("avatar",e.target.files[0]),u.a.post("/upload",t,{headers:{"Content-Type":"multipart/form-data"}}).then((function(e){f("/uploads/"+e.data.src)}))}(e)}}),l.a.createElement("br",null),l.a.createElement("button",null,"\u6ce8\u518c")))}function v(e){var t=Object(m.g)(),a=Object(n.useRef)(),c=Object(n.useRef)(),r=Object(n.useRef)(),o=Object(n.useRef)(),s=Object(n.useState)("/captcha/:0"),d=Object(i.a)(s,2),p=d[0],f=d[1];return l.a.createElement("div",null,l.a.createElement("form",{onSubmit:function(e){return function(e){e.preventDefault(),u.a.post("/login",{name:a.current.value,password:c.current.value,captcha:r.current.value}).then((function(e){2===e.data.code?(alert("\u9a8c\u8bc1\u7801\u9519\u8bef\uff01"),f("/captcha/:"+Math.random())):1===e.data.code?(alert("\u767b\u5f55\u6210\u529f\uff01"),t.push("/")):(alert("\u7528\u6237\u540d\u6216\u5bc6\u7801\u9519\u8bef\uff01"),f("/captcha/:"+Math.random()))}))}(e)}},l.a.createElement("div",null,"\u7528\u6237\u540d\uff1a"),l.a.createElement("input",{type:"text",ref:a}),l.a.createElement("div",null,"\u5bc6\u7801\uff1a"),l.a.createElement("input",{type:"password",ref:c}),l.a.createElement("br",null),l.a.createElement("img",{src:p,alt:"\u9a8c\u8bc1\u7801",ref:o,onClick:function(){return f("/captcha/:"+Math.random())}}),l.a.createElement("br",null),l.a.createElement("div",null,"\u9a8c\u8bc1\u7801\u8f93\u5165\uff1a"),l.a.createElement("input",{type:"text",ref:r}),l.a.createElement("br",null),l.a.createElement("button",null,"\u767b\u5f55"),l.a.createElement("span",null,"\u5fd8\u8bb0\u5bc6\u7801\uff1f")))}a(61);function b(e){return l.a.createElement("div",null,l.a.createElement("div",{id:"main"},l.a.createElement(m.b,{exact:!0,path:"/noLogin"},l.a.createElement(m.a,{to:"/noLogin/login"})),l.a.createElement("div",{id:"header"},l.a.createElement(s.c,{to:"/noLogin/login",activeClassName:"selected"},"\u767b\u5f55"),"|",l.a.createElement(s.c,{to:"/noLogin/register",activeClassName:"selected"},"\u6ce8\u518c")),l.a.createElement(m.b,{path:"/noLogin/login",component:v}),l.a.createElement(m.b,{path:"/noLogin/register",component:E})))}a(62);function h(e){var t=Object(m.g)(),a=Object(n.useState)(!0),c=Object(i.a)(a,2),r=c[0],o=c[1],s=Object(n.useState)(null),d=Object(i.a)(s,2),p=d[0],f=d[1],E=Object(n.useState)(null),v=Object(i.a)(E,2),b=v[0],h=v[1];return Object(n.useEffect)((function(){u.a.get("/votes").then((function(e){f(e.data.votes),o(!1)}))}),[]),r?l.a.createElement("div",null,l.a.createElement("div",{className:"top-banner"},"\u6211\u7684\u6295\u7968")):l.a.createElement("div",null,l.a.createElement("div",{className:"top-banner"},e.user.name," \u7684\u6295\u7968"),l.a.createElement("ul",{style:{listStyle:"none"},id:"me-ul"},p.map((function(e){return l.a.createElement("li",{key:e.voteid,onClick:function(t){return h(b===e.voteid||e.voteid)}},l.a.createElement("div",{className:"topic"},e.topic),b===e.voteid&&l.a.createElement("div",{className:"show"},l.a.createElement("span",{onClick:function(a){return t.push("/voting/".concat(e.voteid))}},"\u67e5\u770b"),l.a.createElement("span",{onClick:function(t){return function(e){u.a.get("/delete/"+e.voteid).then((function(t){f(p.filter((function(t){return e!==t})))}))}(e)}},"\u5220\u9664")))}))))}a(63);function g(e){var t=Object(m.h)().id,a=Object(n.useState)([]),c=Object(i.a)(a,2),r=c[0],o=c[1],d=function(e){var t=Object(n.useState)(!0),a=Object(i.a)(t,2),l=a[0],c=a[1],r=Object(n.useState)(null),m=Object(i.a)(r,2),s=m[0],d=m[1],p=Object(n.useState)(null),f=Object(i.a)(p,2),E=f[0],v=f[1];return Object(n.useEffect)((function(){c(!0),d(null),v(null),o(null),u.a.get(e).then((function(e){d(e.data.votes),v(e.data.options),o(e.data.voted),c(!1)}))}),[e]),[l,s,E]}("/voting/".concat(t)),p=Object(i.a)(d,3),f=p[0],E=p[1],v=p[2];return Object(n.useEffect)((function(){if(E&&Date.now()<new Date(E.deadline).getTime()){var e=new WebSocket("ws://localhost:5000/voting/".concat(t));return e.onmessage=function(e){o(JSON.parse(e.data))},function(){return e.close()}}}),[t,E]),f?l.a.createElement("div",null,"loading"):l.a.createElement("div",null,l.a.createElement("div",{className:"top-banner"},"\u6295\u7968\u5566\uff01"),l.a.createElement(s.b,{to:"/home/me",id:"back"},"<"),l.a.createElement("h1",null,E.topic),"1"===E.multiple?l.a.createElement("div",{className:"ismultiple"},"[\u591a\u9009]"):l.a.createElement("div",{className:"ismultiple"},"[\u5355\u9009]"),l.a.createElement("ul",{style:{listStyle:"none"},id:"voting-ul"},v.map((function(e){return l.a.createElement("li",{key:e.optionid,onClick:function(a){return function(e){if(Date.now()>new Date(E.deadline).getTime())return void alert("\u6295\u7968\u5df2\u622a\u6b62\uff01");u.a.post("/voting/"+t,{optionid:e.optionid,time:Date.now(),multiple:E.multiple}).then((function(e){1===e.data.code&&o(e.data.voted)}))}(e)}},l.a.createElement("div",{className:"content"},l.a.createElement("span",null,e.content),l.a.createElement("div",{className:"percent"},l.a.createElement("span",null,r.filter((function(t){return t.optionid===e.optionid})).length,"\u7968"),l.a.createElement("span",null,0!==r.length?Number(r.filter((function(t){return t.optionid===e.optionid})).length/r.length*100).toFixed(0):0,"%"))),l.a.createElement("div",null,l.a.createElement("progress",{max:r.length,value:r.filter((function(t){return t.optionid===e.optionid})).length},"\u8fdb\u5ea6\u6761")),"true"===E.hidename||"1"===E.hidename?"":l.a.createElement("div",{className:"votedusers"},r.filter((function(t){return t.optionid===e.optionid})).map((function(e){return l.a.createElement("span",{key:e.voteduser},e.voteduser," ")}))))}))),l.a.createElement("span",{id:"time"},"\u6295\u7968\u622a\u6b62\uff1a",E.deadline))}a(64);function O(e){var t=Object(n.useState)(0),a=Object(i.a)(t,2),c=a[0],r=a[1],o=Object(m.g)();return Object(n.useEffect)((function(){u.a.get("/login").then((function(e){e.data.user?r(e.data.user):o.push("/noLogin")})).catch((function(e){o.push("/noLogin")}))}),[o]),l.a.createElement("div",null,l.a.createElement(m.b,{path:"/noLogin"},l.a.createElement(b,{userInfo:c})),l.a.createElement(m.b,{exact:!0,path:"/"},l.a.createElement(m.a,{to:"/home/createVote"})),l.a.createElement(m.b,{path:"/home"},l.a.createElement(m.b,{path:"/home/createVote"},l.a.createElement("div",{className:"top-banner"},"\u963f\u91cc\u6295\u7968"),l.a.createElement("div",{id:"create"},l.a.createElement("div",null,l.a.createElement(s.b,{to:"/creatSingle",className:"create-vote"},"\u5355\u9009\u6295\u7968")),l.a.createElement("div",null,l.a.createElement(s.b,{to:"/creatMultiple",className:"create-vote"},"\u591a\u9009\u6295\u7968")))),l.a.createElement(m.b,{path:"/home/me"},l.a.createElement(h,{user:c})),l.a.createElement("footer",null,l.a.createElement(s.c,{to:"/home/createVote",activeClassName:"active"},"\u65b0\u5efa"),l.a.createElement(s.c,{to:"/home/me",activeClassName:"active"},"\u6211\u7684"))),l.a.createElement(m.d,null,l.a.createElement(m.b,{path:"/creatSingle"},l.a.createElement(f,{multiple:"false"})),l.a.createElement(m.b,{path:"/creatMultiple"},l.a.createElement(f,{multiple:"true"})),l.a.createElement(m.b,{path:"/voting/:id"},l.a.createElement(g,null))))}r.a.render(l.a.createElement(l.a.StrictMode,null,l.a.createElement(s.a,null,l.a.createElement(O,null))),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[31,1,2]]]);
//# sourceMappingURL=main.ec1d9896.chunk.js.map