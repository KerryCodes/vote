{"version":3,"sources":["serviceWorker.js","CreateVote.js","Register.js","Login.js","NoLogin.js","Me.js","Voting.js","Vote.js","index.js"],"names":["Boolean","window","location","hostname","match","count","CreateVote","props","history","useHistory","useState","id","value","options","setOptions","topic","useRef","directions","deadline","hideName","multiple","className","to","onSubmit","e","preventDefault","current","length","Axios","post","checked","then","val","push","data","voteId","alert","handleSubmit","ref","type","placeholder","style","listStyle","map","it","key","onClick","filter","item","onChange","target","handleInput","Register","userName","checkMsg","userPassword","userEmail","imgSrc","setImgSrc","action","method","encType","name","password","email","avatar","code","result","submit","textContent","get","msg","color","htmlFor","src","alt","width","display","FormData","append","files","headers","handleAvatar","Login","captcha","captchaImg","setSrc","Math","random","NoLogin","exact","path","activeClassName","component","Me","loading","setLoading","votes","setVotes","showId","setShowId","useEffect","user","voteid","handleDelete","Voting","useParams","voted","setVoted","url","isLoading","setIsLoading","useFetch","Date","now","getTime","ws","WebSocket","onmessage","JSON","parse","close","optionid","time","handleClick","content","Number","toFixed","max","hidename","p","voteduser","Vote","userInfo","setUserInfo","res","catch","ReactDOM","render","StrictMode","document","getElementById","navigator","serviceWorker","ready","registration","unregister","error","console","message"],"mappings":"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","file":"static/js/main.ec1d9896.chunk.js","sourcesContent":["// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.0/8 are considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\nexport function register(config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href);\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl, config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl, config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl, {\n    headers: { 'Service-Worker': 'script' },\n  })\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready\n      .then(registration => {\n        registration.unregister();\n      })\n      .catch(error => {\n        console.error(error.message);\n      });\n  }\n}\n","import React, { useState, useRef } from 'react'\nimport { Link, useHistory } from 'react-router-dom'\nimport Axios from 'axios'\nimport './createVote.css'\nlet count = 0\n\nexport default function CreateVote(props) {\n  const history= useHistory()\n  const [options, setOptions] = useState([{\n    id: count++,\n    value: '',\n  }])\n  const topic = useRef()\n  const directions = useRef()\n  const deadline = useRef()\n  const hideName= useRef()\n  \n  return (\n    <div>\n      {\n        props.multiple === 'true'\n        ?\n          <div className=\"top-banner\">新建多选投票</div>\n          :\n          <div className=\"top-banner\">新建单选投票</div>\n      }\n      <Link to=\"/\" id=\"back\">&lt;</Link>\n\n      <form onSubmit={e=>handleSubmit(e)}>\n        <input ref={topic} type=\"text\" placeholder=\"投票标题\"></input>\n        <input ref={directions} type=\"text\" placeholder=\"补充描述（选填）\"></input>\n        <ul style={{ listStyle: 'none' }}>\n          {options.map(it =>\n            <li key={it.id}>\n              <div onClick={()=>setOptions(options.filter(item => it.id!==item.id))}>X</div>\n              <input type=\"text\" placeholder=\"选项\" value={it.value} onChange={e=>handleInput(e,it)}></input>\n            </li>\n            )}\n        </ul>\n        <div onClick={e => {e.preventDefault();setOptions([...options, { id: count++, value: '' }])}}>+添加选项</div>\n        <div id=\"deadline\">\n          <div>截止日期</div>\n          <input ref={deadline} type=\"datetime-local\"></input>\n        </div>\n        <div id=\"hidename\">\n          <input ref={hideName} type=\"checkbox\"></input>\n          <div>匿名投票</div>\n        </div>\n        <button id=\"submit\">完成</button>\n      </form>\n    </div>\n  )\n\n  function handleInput(e, it) {\n    setOptions(options.map(item => {\n      if (item.id === it.id) {\n        return {\n          id: it.id,\n          value: e.target.value\n        }\n      } else {\n        return item\n      }\n    }))\n  }\n\n  function handleSubmit(e) {\n    e.preventDefault()\n    if (topic.current.value && options.length >= 2 && deadline.current.value) {\n      Axios.post('/createVote', {\n        topic: topic.current.value,\n        directions: directions.current.value,\n        multiple: props.multiple,\n        options: options,\n        deadline: deadline.current.value,\n        hideName: hideName.current.checked,\n      }).then(val => {\n        history.push('/voting/' + val.data.voteId)\n      })\n    } else {\n      alert('信息未填写完整！')\n    }\n  }\n\n}","import React, { useRef, useState } from 'react'\nimport {useHistory} from 'react-router-dom'\nimport Axios from 'axios'\n\nexport default function Register(props) {\n  const history= useHistory()\n  const userName = useRef()\n  const checkMsg = useRef()\n  const userPassword = useRef()\n  const userEmail = useRef()\n  const [imgSrc, setImgSrc] = useState('/uploads/0.jpg')\n  \n  return (\n    <div>\n      <form action=\"/api/register\" method=\"POST\" encType=\"multipart/form-data\" onSubmit={e=>submit(e)}>\n        <div>用户名：</div>\n        <input type=\"text\" ref={userName} onChange={checkName} />\n        <div ref={checkMsg} style={{color:\"red\"}}>*</div>\n        <div>密码：</div>\n        <input type=\"password\" ref={userPassword} />\n        <div>邮箱：</div>\n        <input type=\"text\" ref={userEmail} />\n        <div>头像上传：</div>\n        <label htmlFor=\"avatar\">\n          <img src={imgSrc} alt=\"avatar\" style={{width:'100px'}}/>\n        </label>\n        <input type=\"file\" id=\"avatar\" style={{display:\"none\"}} onChange={e=>handleAvatar(e)}/><br/>\n        <button>注册</button>\n      </form>\n    </div>\n  )\n\n  function handleAvatar(e) {\n    let data = new FormData()\n\n    data.append('avatar', e.target.files[0])\n    Axios.post('/upload', data, {\n      headers: { \"Content-Type\": \"multipart/form-data\" }\n    }).then(val => {\n      setImgSrc('/uploads/' + val.data.src)\n    })\n  }\n\n  function submit(e) {\n    e.preventDefault()\n    Axios.post('/register', {\n      name: userName.current.value,\n      password: userPassword.current.value,\n      email: userEmail.current.value,\n      avatar: imgSrc,\n    }).then(val => {\n      if (val.data.code === 1) {\n        alert('注册成功，请登录！')\n        history.push('/noLogin/login')\n      } else {\n        alert(val.data.result)\n      }\n    })\n  }\n\n  function checkName(e) {\n    if (!e.target.value) {\n      checkMsg.current.textContent = '*'\n      return\n    }\n    Axios.get('/username-conflict-check?name=' + e.target.value).then(result=>{\n      checkMsg.current.textContent = result.data.msg\n    })\n  }\n}","import React,{useRef, useState} from 'react'\nimport { useHistory } from 'react-router-dom'\nimport Axios from 'axios'\n\nexport default function Login(props) {\n  const history= useHistory()\n  const name = useRef()\n  const password = useRef()\n  const captcha = useRef()\n  const captchaImg = useRef()\n  const [src, setSrc] = useState(\"/captcha/:0\")\n\n\n  function submit(e) {\n    e.preventDefault()\n    Axios.post('/login', {\n      name: name.current.value,\n      password: password.current.value,\n      captcha: captcha.current.value\n    }).then(val => {\n      if (val.data.code === 2) {\n        alert('验证码错误！')\n        setSrc('/captcha/:' + Math.random())\n      } else if (val.data.code === 1) {\n        alert('登录成功！')\n        history.push('/')\n      } else {\n        alert('用户名或密码错误！')\n        setSrc('/captcha/:' + Math.random())\n      }\n    })\n  }\n\n  return (\n    <div>\n      <form onSubmit={e => submit(e)}>\n        <div>用户名：</div>\n        <input type=\"text\" ref={name}/>\n        <div>密码：</div>\n        <input type=\"password\" ref={password}/><br/>\n        <img src={src} alt=\"验证码\" ref={captchaImg} onClick={()=>setSrc('/captcha/:' + Math.random())}/><br />\n        <div>验证码输入：</div>\n        <input type=\"text\" ref={captcha}/><br />\n        <button>登录</button><span>忘记密码？</span>\n      </form>\n    </div>\n  )\n\n\n}","import React from 'react'\nimport { Route, NavLink, Redirect } from 'react-router-dom'\nimport Register from './Register'\nimport Login from './Login'\nimport './noLogin.css'\n\nexport default function NoLogin(props) {\n\n  return (\n    <div>\n      <div id=\"main\">\n        <Route exact path=\"/noLogin\">\n          <Redirect to=\"/noLogin/login\"></Redirect>\n        </Route>\n\n        <div id=\"header\">\n          <NavLink to=\"/noLogin/login\" activeClassName=\"selected\" >登录</NavLink>\n          |\n          <NavLink to=\"/noLogin/register\" activeClassName=\"selected\">注册</NavLink>\n        </div>\n\n        <Route path=\"/noLogin/login\" component={Login}></Route>\n        <Route path=\"/noLogin/register\" component={Register}></Route>\n      </div>\n    </div>\n  )\n}","import React, { useEffect, useState } from 'react'\nimport {useHistory} from 'react-router-dom'\nimport Axios from 'axios'\nimport './me.css'\n\nexport default function Me(props) {\n  const history= useHistory()\n  const [loading, setLoading]= useState(true)\n  const [votes, setVotes] = useState(null)\n  const [showId, setShowId]= useState(null)\n  \n  useEffect(() => {\n    Axios.get('/votes').then(val => {\n      setVotes(val.data.votes)\n      setLoading(false)\n    })\n  }, [])\n\n  if (loading) {\n    return (\n      <div>\n        <div className=\"top-banner\">我的投票</div>\n      </div>\n    )\n  } else {\n    return (\n      <div>\n        <div className=\"top-banner\">{props.user.name} 的投票</div>\n        <ul style={{listStyle:\"none\"}} id=\"me-ul\">\n        {\n          votes.map(it =>\n            <li key={it.voteid} onClick={e=>setShowId(showId === it.voteid || it.voteid)}>\n              <div className=\"topic\">{it.topic}</div>\n              {showId === it.voteid && \n                <div className=\"show\">\n                  <span onClick={e => history.push(`/voting/${it.voteid}`)}>查看</span>\n                  <span onClick={e => handleDelete(it)}>删除</span>\n                </div>\n              }\n            </li>\n          )\n        }\n        </ul>\n        {/* <button onClick={e=>Axios.get('/logout')}>退出登录</button> */}\n      </div>\n    )\n  }\n\n  function handleDelete(it) {\n    Axios.get('/delete/' + it.voteid).then(val => {\n      setVotes(votes.filter(item => it !== item))\n    })\n  }\n  \n}","import React,{useEffect, useState} from 'react'\nimport { useParams, Link } from 'react-router-dom'\nimport Axios from 'axios'\nimport './voting.css'\n\nexport default function Voting(props) {\n  const { id } = useParams()\n  const [voted, setVoted] = useState([])\n  const [isLoading, votes, options] = useFetch(`/voting/${id}`)\n\n  useEffect(() => {\n    if (!votes) { return }\n    if (Date.now() < (new Date(votes.deadline)).getTime()) {\n      // let ws = new WebSocket(`ws://${window.location.host}/voting/${id}`)\n      let ws = new WebSocket(`ws://localhost:5000/voting/${id}`)\n      \n      ws.onmessage = function (e) {\n        setVoted(JSON.parse(e.data))\n      }\n      return () => ws.close()\n    }\n  }, [id, votes])\n\n\n  if (isLoading) {\n    return (\n      <div>loading</div>\n    )\n  } else {\n    return (\n      <div>\n        <div className=\"top-banner\">投票啦！</div>\n        <Link to=\"/home/me\" id=\"back\">&lt;</Link>\n        <h1>{votes.topic}</h1>\n        {\n          votes.multiple === '1'\n            ?\n            <div className=\"ismultiple\">[多选]</div>\n            :\n            <div className=\"ismultiple\">[单选]</div>\n        }\n        <ul style={{ listStyle: 'none' }} id=\"voting-ul\">\n          {\n            options.map(it =>\n              <li key={it.optionid} onClick={e => handleClick(it)}>\n                <div className=\"content\">\n                  <span>{it.content}</span>\n                  <div className=\"percent\">\n                    <span>{voted.filter(item => item.optionid === it.optionid).length}票</span>\n                    <span>{voted.length !==0 ? Number((voted.filter(item=>item.optionid===it.optionid).length/voted.length)*100).toFixed(0) : 0}%</span>\n                  </div>\n                </div>\n                <div>\n                  <progress max={voted.length} value={voted.filter(item => item.optionid === it.optionid).length}>进度条</progress>\n                </div>\n                {\n                  votes.hidename === 'true' || votes.hidename === '1' ?\n                    ''\n                    :\n                    <div className=\"votedusers\">\n                      {\n                        voted.filter(item => item.optionid === it.optionid).map(p => \n                          <span key={p.voteduser}>{p.voteduser} </span>\n                        )\n                      }\n                    </div>\n                }\n              </li>\n              )\n          }\n        </ul>\n        <span id=\"time\">投票截止：{votes.deadline}</span>\n      </div>\n    )\n  }\n\n  function handleClick(it) {\n    if (Date.now() > (new Date(votes.deadline)).getTime()) {\n      alert('投票已截止！')\n      return\n    }\n    Axios.post('/voting/' + id, {\n      optionid: it.optionid,\n      time: Date.now(),\n      multiple: votes.multiple,\n    }).then(val => {\n      if (val.data.code === 1) {\n        setVoted(val.data.voted)\n      }\n    })\n  }\n\n  function useFetch(url) {\n    const [isLoading, setIsLoading] = useState(true)\n    const [votes, setVotes] = useState(null)\n    const [options, setOptions] = useState(null)\n    \n    useEffect(() => {\n      setIsLoading(true)\n      setVotes(null)\n      setOptions(null)\n      setVoted(null)\n      Axios.get(url).then(val => {\n        setVotes(val.data.votes)\n        setOptions(val.data.options)\n        setVoted(val.data.voted)\n        setIsLoading(false)\n      })\n      // (async function() {\n      //   setIsLoading(true)\n      //   setResult(null)\n      //   let res = await Axios.get(url)\n\n      //   setResult(res.data)\n      //   setIsLoading(false)\n      // })()\n    }, [url])\n\n    return [isLoading, votes, options]\n  }\n\n}","import React,{useEffect, useState} from 'react'\nimport Axios from 'axios'\nimport { Route, useHistory, Link, NavLink, Switch, Redirect } from 'react-router-dom'\nimport CreateVote from './CreateVote'\nimport NoLogin from './NoLogin'\nimport Me from './Me'\nimport Voting from './Voting'\nimport './vote.css'\n\n\nexport default function Vote(props) {\n  const [userInfo, setUserInfo] = useState(0)\n  const history = useHistory()\n  \n  useEffect(() => {\n    Axios.get('/login').then(res => {\n      if (res.data.user) {\n        setUserInfo(res.data.user)\n      } else {\n        history.push('/noLogin')\n      }\n    }).catch(e => {\n      history.push('/noLogin')\n    })\n  }, [history])\n  \n  return (\n    <div>\n      <Route path=\"/noLogin\">\n          <NoLogin userInfo={userInfo}></NoLogin>\n      </Route>\n\n      <Route exact path=\"/\">\n        <Redirect to=\"/home/createVote\"></Redirect>\n      </Route>\n\n      <Route path='/home'>\n        <Route path=\"/home/createVote\">\n          <div className=\"top-banner\">阿里投票</div>\n          <div id=\"create\">\n            <div>\n              <Link to=\"/creatSingle\" className=\"create-vote\">单选投票</Link>\n            </div>\n            <div>\n              <Link to=\"/creatMultiple\" className=\"create-vote\">多选投票</Link>\n            </div>\n          </div>\n        </Route>\n\n        <Route path=\"/home/me\">\n          <Me user={userInfo}></Me>\n        </Route>\n\n        <footer>\n          <NavLink to=\"/home/createVote\" activeClassName=\"active\">新建</NavLink>\n          <NavLink to=\"/home/me\" activeClassName=\"active\">我的</NavLink>\n        </footer>\n      </Route>\n      \n      <Switch>\n        <Route path=\"/creatSingle\">\n          <CreateVote multiple='false'></CreateVote>\n        </Route>\n        <Route path=\"/creatMultiple\">\n          <CreateVote multiple='true'></CreateVote>\n        </Route>\n        <Route path=\"/voting/:id\">\n          <Voting></Voting>\n        </Route>\n      </Switch>\n    </div>\n  )\n    \n}","import React from 'react';\nimport ReactDOM from 'react-dom';\n// import './index.css';\nimport * as serviceWorker from './serviceWorker';\nimport Vote from './Vote'\nimport {HashRouter} from 'react-router-dom'\n\n\nReactDOM.render(\n  <React.StrictMode>\n    <HashRouter>\n      <Vote />\n    </HashRouter>\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\nserviceWorker.unregister();\n"],"sourceRoot":""}